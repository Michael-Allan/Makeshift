#!/usr/bin/env --split-string=${JDK_HOME}/bin/java @building/javac_arguments @building/java_arguments \c [SS]
package building; // [AFN]

// Usage from working directory `<PROJECTS>/`:  build <PROJECT>/ <target>…

import java.io.*;


/** A shell command to build the software of a given project,
  * compiling the code and preparing it for use.
  */
public final class BuildCommand { // [AFN]



    private BuildCommand() {}



    /** Executes the command as given by the shell.
      */
    public static void main( final String[] arguments ) throws IOException {
        if( arguments.length < 2 ){
            System.err.println( "Usage: build <PROJECT>/ <target>..." );
            return; }

        new BuildCommand().execute(); }



////  P r i v a t e  ////////////////////////////////////////////////////////////////////////////////////


    /** Executes the command.
      */
    private void execute() throws IOException {
        // Already the working directory is `*PROJECTS*/`.  `../build_instructions.brec`
        final ProcessBuilder pB = new ProcessBuilder(
          System.getProperty("java.home") + "/bin/javac", /* The Java installation at `java.home` is
               known to include `javac` because it is a JDK, as assured by the `JDK_HOME` at top. */
            "@building/javac_arguments", "@building/javac_arguments_addendum",
            "building/Autobuilder.java" );
        try {
            final int exitValue =  pB.start().waitFor();
            if( exitValue != 0 ) { throw new IOException( "Exit value of " + exitValue
              + " from process: " + pB.command() ); }}
        catch( InterruptedException x ) { throw new IOException( x ); }

        final Autobuilder autobuilder = new Autobuilder(); }}



// NOTES
// ─────
//   AFN  Atypical file naming is allowed here.  ‘The compiler does not enforce the optional restriction
//        defined at the end of JLS §7.6, that a type in a named package should exist in a file whose
//        name is composed from the type name followed by the .java extension.’
//        http://openjdk.java.net/jeps/330
//        https://docs.oracle.com/javase/specs/jls/se14/html/jls-7.html#jls-7.6
//
//   SS · Here the long form `--split-string` (as opposed to `-S`) enables Emacs to recognize this file
//        as Java source code.  See the note entitled ‘source-launch files encoded with a shebang’ at
//        `http://reluk.ca/project/Java/Emacs/user_instructions.brec`.



                                       // Copyright © 2020, Michael Allan and contributors.  Licence MIT.
